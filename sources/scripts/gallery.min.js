/*
 * Photo Gallery
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/photo-gallery
 * @version: 1.0.1
 * Released 9/19/2012
 * Updated 5/1/2015
 *
 * @license: GNU GENERAL PUBLIC LICENSE v3
 *
    Storybook Plus is an web application that serves multimedia contents.
    Copyright (C) 2013-2015  Ethan S. Lin, UWEX CEOEL Media Services

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
$(document).ready(function(){function e(e){var i=$(e).find("setup"),o=$(e).find("image"),n=i.find("imgFormat").text().length<=0?"png":i.find("imgFormat").text();a=i.find("slideDuration").text().length<=0?6e3:1e3*i.find("slideDuration").text(),$("#images").html(""),o.each(function(e){var t=$(this).attr("fileName").toLowerCase(),r=$(this).find("title").text(),i=$(this).find("description").text();$("#images").append('<div class="thumb" id="thumb'+(e+1)+'"><a class="fancybox" data-title-id="title-'+(e+1)+'" rel="gallery" href="assets/images/'+t+"."+n+'"><img src="assets/thumbs/'+t+"."+n+'" width="150" height="80" border="0" alt="'+r+'" /></a></div><div id="title-'+(e+1)+'" class="hidden" rel="popover"><h3>'+r+"</h3><div>"+i+"</div>")}),$("#images").preloader(),t(),r()}function t(){for(var e=$("div.thumb").length,t=0;e>t;t++){var r=$("#title-"+(t+1)+" h3").html(),i=$("#title-"+(t+1)+" div").html();i.length>125&&(i=i.substring(0,122)+"..."),$("#thumb"+(t+1)).popover({placement:"top",trigger:"hover",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',delay:{show:500,hide:0},title:r,content:i})}}function r(){function e(e,t){var r,i=t.data("title-id");i&&(r=$("#"+i),r.length&&(e.title=r.html()))}!function($,e){e.transitions.resizeIn=function(){var t=e.previous,r=e.current,i=t.wrap.stop(!0).position(),o=$.extend({opacity:1},r.pos);i.width=t.wrap.width(),i.height=t.wrap.height(),t.wrap.stop(!0).trigger("onReset").remove(),delete o.position,r.inner.hide(),r.wrap.css(i).animate(o,{duration:r.nextSpeed,easing:r.nextEasing,step:e.transitions.step,complete:function(){e._afterZoomIn(),r.inner.fadeIn("fast")}})}}(jQuery,jQuery.fancybox),$(".fancybox").attr("rel","gallery").fancybox({nextMethod:"resizeIn",nextSpeed:500,prevMethod:!1,autoPlay:!1,autoSize:!0,autoResize:!0,aspectRatio:!0,fitToView:!0,playSpeed:a,helpers:{title:{type:"inside"},overlay:{css:{background:"rgba(255, 255, 255, 0.80)"}}},beforeLoad:function(){e(this,$(this.element))},beforeShow:function(){$("#timer").hide()},afterShow:function(){},afterClose:function(){n=!1}}),$(".openPlay").bind("click",function(){return n=!0,$.fancybox.open($(".fancybox"),{nextMethod:"resizeIn",nextSpeed:500,prevMethod:!1,autoPlay:!0,autoSize:!0,autoResize:!0,aspectRatio:!0,fitToView:!0,playSpeed:a,helpers:{title:{type:"inside"},overlay:{css:{background:"rgba(255, 255, 255, 0.80)"}}},beforeLoad:function(){e(this,$(this.element))},beforeShow:function(){$("#timer").hide()},afterShow:function(){o()},afterClose:function(){n=!1}}),!1})}function i(e,t){var r,i;r=0===e?"<strong>Error 0</strong> - Not connect. Please verify network.":404===e?"<strong>Error 404</strong> - Requested page not found.":406===e?"<strong>Error 406</strong> - File is not acceptable.":500===e?"<strong>Error 500</strong> - Internal server error.":"Unknow error",i="parsererror"===t?"Requested XML failed to parse.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"error"===t?"HTTP / URL error.":"Uncaught error:\n"+e.responseText,$(".autoOpenPlay").hide(),$("footer .errorMsg").html(r+"<br />"+i)}function o(){var e=$("#timer .progress");n===!0?($("#timer").show(),e.animate({width:"100%"},a,"linear",function(){$(this).animate({opacity:0},1e3,function(){$(this).css({width:"0%",opacity:"1"})})})):(e.stop().css({width:"0%",opacity:"1"}),$("#timer").hide())}var n=!1,a;$.ajaxSetup({url:"assets/gallery.xml",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1}),$.ajax({type:"get",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8"),e.setRequestHeader("Accept","text/xml")},success:function(t){e(t)},error:function(e,t){i(e.status,t)}})});