// Programmer:	Ethan S. Lin
// Program:		Photo Gallery
// Date:		September 19th, 2012
// Copyright:	UWEX-CEOEL (C) 2012

var isPlaying=false;var transTime;$(document).ready(function(){var f=sniffUA();var g='';$.ajaxSetup({url:'assets/gallery.xml',dataType:'xml',accepts:'xml',content:'xml',contentType:'xml; charset="utf-8"',cache:false});$.ajax({type:'get',beforeSend:function(a){a.overrideMimeType("xml; charset=utf-8");a.setRequestHeader("Accept","text/xml")},success:function(a){setupXML(a)},error:function(a,b){displayError(a.status,b)}});function setupXML(d){var e=$(d).find('setup'),IMAGE=$(d).find('image'),galleryTitle=e.find('galleryTitle').text(),galleryDesc=e.find('galleryDescription').text(),totalImages=IMAGE.length,imageType=(e.find('imgFormat').text().length<=0)?'png':e.find('imgFormat').text();transTime=(e.find('slideDuration').text().length<=0)?6*1000:e.find('slideDuration').text()*1000;$('#gallery .title').html(galleryTitle);if(galleryDesc.length>0){$('#gallery .description').html(galleryDesc)}$('#images').html('');IMAGE.each(function(i){var a=$(this).attr('fileName');var b=$(this).find('title').text();var c=$(this).find('description').text();$('#images').append('<div class="thumb" id="thumb'+(i+1)+'"><a class="fancybox" data-title-id="title-'+(i+1)+'" rel="gallery" href="assets/images/'+a+'.'+imageType+'"> <img src="assets/thumbs/'+a+'.'+imageType+'" width="150" height="80" border="0" alt="'+b+'" /> </a></div><div id="title-'+(i+1)+'" class="hidden" rel="popover"><h3>'+b+'</h3><div>'+c+'</div>')});$("#images").preloader();if(!f){initPopOver()}initFancybox()}function initPopOver(){var a=$('div.thumb').length;for(var i=0;i<a;i++){var b=$('#title-'+(i+1)+' h3').html(),popContent=$('#title-'+(i+1)+' div').html();if(popContent.length>125){popContent=popContent.substring(0,122)+"..."}$('#thumb'+(i+1)).popover({placement:'top',trigger:'hover',delay:{show:500,hide:0},title:b,content:popContent})}}function initFancybox(){(function($,F){F.transitions.resizeIn=function(){var a=F.previous,current=F.current,startPos=a.wrap.stop(true).position(),endPos=$.extend({opacity:1},current.pos);startPos.width=a.wrap.width();startPos.height=a.wrap.height();a.wrap.stop(true).trigger('onReset').remove();delete endPos.position;current.inner.hide();current.wrap.css(startPos).animate(endPos,{duration:current.nextSpeed,easing:current.nextEasing,step:F.transitions.step,complete:function(){F._afterZoomIn();current.inner.fadeIn("fast")}})}}(jQuery,jQuery.fancybox));$(".fancybox").attr('rel','gallery').fancybox({nextMethod:'resizeIn',nextSpeed:500,prevMethod:false,autoPlay:false,autoSize:true,autoResize:false,aspectRatio:false,fitToView:false,playSpeed:transTime,helpers:{title:{type:'inside'},overlay:{css:{'background':'rgba(250, 250, 250, 0.85)'}}},beforeLoad:function(){addDescription(this,$(this.element))},beforeShow:function(){$('#timer').hide()},afterShow:function(){startTimer(isPlaying)},afterClose:function(){isNotPlaying()}});$('.openPlay').bind('click',function(){currentlyPlaying();$.fancybox.open($(".fancybox"),{nextMethod:'resizeIn',nextSpeed:500,prevMethod:false,autoPlay:true,autoSize:true,autoResize:false,aspectRatio:false,fitToView:false,playSpeed:transTime,helpers:{title:{type:'inside'},overlay:{css:{'background':'rgba(250, 250, 250, 0.85)'}}},beforeLoad:function(){addDescription(this,$(this.element))},beforeShow:function(){$('#timer').hide()},afterShow:function(){startTimer(isPlaying)},afterClose:function(){isNotPlaying()}})});function addDescription(n,e){var a,id=e.data('title-id'),controls;if(isPlaying==false){controls='Start Slideshow'}else{controls='Stop'}if(id){a=$('#'+id);if(a.length){n.title='<div class="controls"><a class="btn playStop" href="javascript:void(0);" onClick="playStop();">'+controls+'</a></div>'+a.html()}}}}function displayError(a,b){var c,exceptionMsg;if(a===0){c='<strong>Error 0</strong> - Not connect. Please verify network.'}else if(a===404){c='<strong>Error 404</strong> - Requested page not found.'}else if(a===406){c='<strong>Error 406</strong> - File is not acceptable.'}else if(a===500){c='<strong>Error 500</strong> - Internal server error.'}else{c='Unknow error'}if(b==='parsererror'){exceptionMsg='Requested XML failed to parse.'}else if(b==='timeout'){exceptionMsg='Time out error.'}else if(b==='abort'){exceptionMsg='Ajax request aborted.'}else if(b==="error"){exceptionMsg='HTTP / URL error.'}else{exceptionMsg=('Uncaught error:\n'+a.responseText)}$('.autoOpenPlay').hide();$('footer .errorMsg').html(c+'<br />'+exceptionMsg)}function sniffUA(){var a=navigator.userAgent,output=$('#gallery footer .device');var b={ios:a.match(/(iPhone|iPod|iPad)/),blackberry:a.match(/BlackBerry/),android:a.match(/Android/),browser:a.match(/(Mozilla|Webkit|msie|Opera)/)};if(b.android){output.append('an Android device.');return true}else if(b.ios){output.append('an iOS device.');return true}else if(b.blackberry){output.append('a Blackberry device.');return true}else if(b.browser){output.append('a desktop/laptop web browser.');return false}else{output.append('an unknown device.');return true}}});function playStop(){if(isPlaying==false){$(".playStop").html('Stop');currentlyPlaying();startTimer(isPlaying)}else{$(".playStop").html('Start Slideshow');isNotPlaying();startTimer(isPlaying)}$.fancybox.play()}function isNotPlaying(){isPlaying=false}function currentlyPlaying(){isPlaying=true}function startTimer(a){var b=$('#timer .progress');if(a==true){$('#timer').show();b.animate({width:'100%'},transTime,'linear',function(){$(this).animate({opacity:0},1000,function(){$(this).css({'width':'0%','opacity':'1'})})})}else{b.stop().css({'width':'0%','opacity':'1'});$('#timer').hide()}}