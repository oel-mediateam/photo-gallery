/*
 * Photo Gallery
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/photo-gallery
 * @version: 1.0.1
 * Released 9/19/2012
 *
 * @license: GNU GENERAL PUBLIC LICENSE v3
 *
    Storybook Plus is an web application that serves multimedia contents.
    Copyright (C) 2013-2015  Ethan S. Lin, UWEX CEOEL Media Services

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
$(document).ready(function(){function e(e){var r=$(e).find("setup"),o=$(e).find("image"),n=r.find("galleryTitle").text(),s=r.find("galleryDescription").text(),l=r.find("imgFormat").text().length<=0?"png":r.find("imgFormat").text();a=r.find("slideDuration").text().length<=0?6e3:1e3*r.find("slideDuration").text(),$("#gallery .title").html(n),s.length>0&&$("#gallery .description").html(s),$("#images").html(""),o.each(function(e){var t=$(this).attr("fileName"),i=$(this).find("title").text(),r=$(this).find("description").text();$("#images").append('<div class="thumb" id="thumb'+(e+1)+'"><a class="fancybox" data-title-id="title-'+(e+1)+'" rel="gallery" href="assets/images/'+t+"."+l+'"><img src="assets/thumbs/'+t+"."+l+'" width="150" height="80" border="0" alt="'+i+'" /></a></div><div id="title-'+(e+1)+'" class="hidden" rel="popover"><h3>'+i+"</h3><div>"+r+"</div>")}),$("#images").preloader(),t(),i()}function t(){for(var e=$("div.thumb").length,t=0;e>t;t++){var i=$("#title-"+(t+1)+" h3").html(),r=$("#title-"+(t+1)+" div").html();r.length>125&&(r=r.substring(0,122)+"..."),$("#thumb"+(t+1)).popover({placement:"top",trigger:"hover",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',delay:{show:500,hide:0},title:i,content:r})}}function i(){function e(e,t){var i,r=t.data("title-id");r&&(i=$("#"+r),i.length&&(e.title=i.html()))}!function($,e){e.transitions.resizeIn=function(){var t=e.previous,i=e.current,r=t.wrap.stop(!0).position(),o=$.extend({opacity:1},i.pos);r.width=t.wrap.width(),r.height=t.wrap.height(),t.wrap.stop(!0).trigger("onReset").remove(),delete o.position,i.inner.hide(),i.wrap.css(r).animate(o,{duration:i.nextSpeed,easing:i.nextEasing,step:e.transitions.step,complete:function(){e._afterZoomIn(),i.inner.fadeIn("fast")}})}}(jQuery,jQuery.fancybox),$(".fancybox").attr("rel","gallery").fancybox({nextMethod:"resizeIn",nextSpeed:500,prevMethod:!1,autoPlay:!1,autoSize:!0,autoResize:!0,aspectRatio:!0,fitToView:!0,playSpeed:a,helpers:{title:{type:"inside"},overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},beforeLoad:function(){e(this,$(this.element))},beforeShow:function(){$("#timer").hide()},afterShow:function(){},afterClose:function(){n=!1}}),$(".openPlay").bind("click",function(){n=!0,$.fancybox.open($(".fancybox"),{nextMethod:"resizeIn",nextSpeed:500,prevMethod:!1,autoPlay:!0,autoSize:!0,autoResize:!0,aspectRatio:!0,fitToView:!0,playSpeed:a,helpers:{title:{type:"inside"},overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},beforeLoad:function(){e(this,$(this.element))},beforeShow:function(){$("#timer").hide()},afterShow:function(){o()},afterClose:function(){n=!1}})})}function r(e,t){var i,r;i=0===e?"<strong>Error 0</strong> - Not connect. Please verify network.":404===e?"<strong>Error 404</strong> - Requested page not found.":406===e?"<strong>Error 406</strong> - File is not acceptable.":500===e?"<strong>Error 500</strong> - Internal server error.":"Unknow error",r="parsererror"===t?"Requested XML failed to parse.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"error"===t?"HTTP / URL error.":"Uncaught error:\n"+e.responseText,$(".autoOpenPlay").hide(),$("footer .errorMsg").html(i+"<br />"+r)}function o(){var e=$("#timer .progress");n===!0?($("#timer").show(),e.animate({width:"100%"},a,"linear",function(){$(this).animate({opacity:0},1e3,function(){$(this).css({width:"0%",opacity:"1"})})})):(e.stop().css({width:"0%",opacity:"1"}),$("#timer").hide())}var n=!1,a;$.ajaxSetup({url:"assets/gallery.xml",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1}),$.ajax({type:"get",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8"),e.setRequestHeader("Accept","text/xml")},success:function(t){e(t)},error:function(e,t){r(e.status,t)}})});