/*
 * Photo Gallery
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/photo-gallery
 * @version: 1.0.1
 * Released 9/19/2012
 *
 * @license: GNU GENERAL PUBLIC LICENSE v3
 *
    Storybook Plus is an web application that serves multimedia contents.
    Copyright (C) 2013-2015  Ethan S. Lin, UWEX CEOEL Media Services

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
var isPlaying=!1,transTime;$(document).ready(function(){function e(e){var n=$(e).find("setup"),r=$(e).find("image"),a=n.find("galleryTitle").text(),o=n.find("galleryDescription").text(),s=n.find("imgFormat").text().length<=0?"png":n.find("imgFormat").text();transTime=n.find("slideDuration").text().length<=0?6e3:1e3*n.find("slideDuration").text(),$("#gallery .title").html(a),o.length>0&&$("#gallery .description").html(o),$("#images").html(""),r.each(function(e){var t=$(this).attr("fileName"),i=$(this).find("title").text(),n=$(this).find("description").text();$("#images").append('<div class="thumb" id="thumb'+(e+1)+'"><a class="fancybox" data-title-id="title-'+(e+1)+'" rel="gallery" href="assets/images/'+t+"."+s+'"> <img src="assets/thumbs/'+t+"."+s+'" width="150" height="80" border="0" alt="'+i+'" /> </a></div><div id="title-'+(e+1)+'" class="hidden" rel="popover"><h3>'+i+"</h3><div>"+n+"</div>")}),$("#images").preloader(),t(),i()}function t(){for(var e=$("div.thumb").length,t=0;e>t;t++){var i=$("#title-"+(t+1)+" h3").html(),n=$("#title-"+(t+1)+" div").html();n.length>125&&(n=n.substring(0,122)+"..."),$("#thumb"+(t+1)).popover({placement:"top",trigger:"hover",delay:{show:500,hide:0},title:i,content:n})}}function i(){function e(e,t){var i,n=t.data("title-id"),r;r=isPlaying===!1?"Start Slideshow":"Stop",n&&(i=$("#"+n),i.length&&(e.title='<div class="controls"><a class="btn playStop" href="javascript:void(0);" onClick="playStop();">'+r+"</a></div>"+i.html()))}!function($,e){e.transitions.resizeIn=function(){var t=e.previous,i=e.current,n=t.wrap.stop(!0).position(),r=$.extend({opacity:1},i.pos);n.width=t.wrap.width(),n.height=t.wrap.height(),t.wrap.stop(!0).trigger("onReset").remove(),delete r.position,i.inner.hide(),i.wrap.css(n).animate(r,{duration:i.nextSpeed,easing:i.nextEasing,step:e.transitions.step,complete:function(){e._afterZoomIn(),i.inner.fadeIn("fast")}})}}(jQuery,jQuery.fancybox),$(".fancybox").attr("rel","gallery").fancybox({nextMethod:"resizeIn",nextSpeed:500,prevMethod:!1,autoPlay:!1,autoSize:!0,autoResize:!1,aspectRatio:!1,fitToView:!1,playSpeed:transTime,helpers:{title:{type:"inside"},overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},beforeLoad:function(){e(this,$(this.element))},beforeShow:function(){$("#timer").hide()},afterShow:function(){a(isPlaying)},afterClose:function(){isPlaying=!1}}),$(".openPlay").bind("click",function(){isPlaying=!0,$.fancybox.open($(".fancybox"),{nextMethod:"resizeIn",nextSpeed:500,prevMethod:!1,autoPlay:!0,autoSize:!0,autoResize:!1,aspectRatio:!1,fitToView:!1,playSpeed:transTime,helpers:{title:{type:"inside"},overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},beforeLoad:function(){e(this,$(this.element))},beforeShow:function(){$("#timer").hide()},afterShow:function(){a(isPlaying)},afterClose:function(){isPlaying=!1}})})}function n(e,t){var i,n;i=0===e?"<strong>Error 0</strong> - Not connect. Please verify network.":404===e?"<strong>Error 404</strong> - Requested page not found.":406===e?"<strong>Error 406</strong> - File is not acceptable.":500===e?"<strong>Error 500</strong> - Internal server error.":"Unknow error",n="parsererror"===t?"Requested XML failed to parse.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"error"===t?"HTTP / URL error.":"Uncaught error:\n"+e.responseText,$(".autoOpenPlay").hide(),$("footer .errorMsg").html(i+"<br />"+n)}function r(){isPlaying===!1?($(".playStop").html("Stop"),isPlaying=!0,a(isPlaying)):($(".playStop").html("Start Slideshow"),isPlaying=!1,a(isPlaying)),$.fancybox.play()}function a(e){var t=$("#timer .progress");e===!0?($("#timer").show(),t.animate({width:"100%"},transTime,"linear",function(){$(this).animate({opacity:0},1e3,function(){$(this).css({width:"0%",opacity:"1"})})})):(t.stop().css({width:"0%",opacity:"1"}),$("#timer").hide())}$.ajaxSetup({url:"assets/gallery.xml",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1}),$.ajax({type:"get",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8"),e.setRequestHeader("Accept","text/xml")},success:function(t){e(t)},error:function(e,t){n(e.status,t)}})});